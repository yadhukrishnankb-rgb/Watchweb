<!-- <%- include('../../partials/user/header') %>

<div class="container mx-auto px-4 py-8">
    <!-- Filters Section -->
    <div class="bg-white p-4 rounded-lg shadow mb-6">
        <form id="filterForm" class="space-y-4">
            <!-- Search Bar -->
            <div class="flex gap-4">
                <input type="text" 
                       name="search" 
                       value="<%= query.search || '' %>"
                       placeholder="Search products..." 
                       class="flex-1 p-2 border rounded">
                
                <button type="submit" 
                        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    Search
                </button>
                
                <% if (Object.keys(query).length > 0) { %>
                    <a href="/products" 
                       class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                        Clear All
                    </a>
                <% } %>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Sort Options -->
                <select name="sort" class="p-2 border rounded" onchange="this.form.submit()">
                    <option value="">Sort By</option>
                    <option value="price-asc" <%= query.sort === 'price-asc' ? 'selected' : '' %>>
                        Price: Low to High
                    </option>
                    <option value="price-desc" <%= query.sort === 'price-desc' ? 'selected' : '' %>>
                        Price: High to Low
                    </option>
                    <option value="name-asc" <%= query.sort === 'name-asc' ? 'selected' : '' %>>
                        Name: A to Z
                    </option>
                    <option value="name-desc" <%= query.sort === 'name-desc' ? 'selected' : '' %>>
                        Name: Z to A
                    </option>
                    <option value="newest" <%= query.sort === 'newest' ? 'selected' : '' %>>
                        Newest First
                    </option>
                </select>

                <!-- Category Filter -->
                <select name="category" class="p-2 border rounded" onchange="this.form.submit()">
                    <option value="">All Categories</option>
                    <% categories.forEach(category => { %>
                        <option value="<%= category._id %>" 
                                <%= query.category === category._id.toString() ? 'selected' : '' %>>
                            <%= category.name %>
                        </option>
                    <% }); %>
                </select>

                <!-- Price Range Filter -->
                <div class="flex gap-2">
                    <input type="number" 
                           name="minPrice" 
                           value="<%= query.minPrice || '' %>"
                           placeholder="Min Price" 
                           min="<%= priceRange.minPrice %>"
                           max="<%= priceRange.maxPrice %>"
                           class="w-1/2 p-2 border rounded">
                    <input type="number" 
                           name="maxPrice" 
                           value="<%= query.maxPrice || '' %>"
                           placeholder="Max Price" 
                           min="<%= priceRange.minPrice %>"
                           max="<%= priceRange.maxPrice %>"
                           class="w-1/2 p-2 border rounded">
                </div>

                <!-- Brand Filter -->
                <select name="brand" class="p-2 border rounded" onchange="this.form.submit()">
                    <option value="">All Brands</option>
                    <% brands.forEach(brand => { %>
                        <option value="<%= brand %>" 
                                <%= query.brand === brand ? 'selected' : '' %>>
                            <%= brand %>
                        </option>
                    <% }); %>
                </select>
            </div>
        </form>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <% products.forEach(product => { %>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <img src="<%= product.productImage[0] %>" 
                     alt="<%= product.productName %>" 
                     class="w-full h-48 object-cover">
                
                <div class="p-4">
                    <h3 class="font-bold text-lg mb-2"><%= product.productName %></h3>
                    <p class="text-gray-600 mb-2"><%= product.category.name %></p>
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-lg font-bold">₹<%= product.salesPrice %></p>
                            <% if (product.regularPrice > product.salesPrice) { %>
                                <p class="text-sm text-gray-500 line-through">
                                    ₹<%= product.regularPrice %>
                                </p>
                            <% } %>
                        </div>
                        <button onclick="addToCart('<%= product._id %>')"
                                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        <% }); %>
    </div>

    <!-- Pagination -->
    <% if (totalPages > 1) { %>
        <div class="mt-8 flex justify-center gap-2">
            <% for(let i = 1; i <= totalPages; i++) { %>
                <a href="?page=<%= i %>&<%= new URLSearchParams({...query, page: undefined}).toString() %>"
                   class="px-4 py-2 border rounded <%= currentPage === i ? 'bg-blue-500 text-white' : 'hover:bg-gray-100' %>">
                    <%= i %>
                </a>
            <% } %>
        </div>
    <% } %>
</div>

<script>
document.getElementById('filterForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const params = new URLSearchParams();
    
    for (let [key, value] of formData) {
        if (value) params.append(key, value);
    }
    
    window.location.href = `/products?${params.toString()}`;
});

function addToCart(productId) {
    // Implement add to cart functionality
}
</script>

<%- include('../../partials/user/footer') %> -->