
<%-include("../../views/partials/user/header")%>

    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== HOME ===============-->
      <section class="home section--lg">
        <div class="home__container container grid">
          <div class="home__content">
            <span class="home__subtitle">Hot Promotions</span>
            <h1 class="home__title">
              Fashion  Trending <span>Great Watch Collection</span>
            </h1>
            <p class="home__description">
              Save more with coupons & up tp 20% off
            </p>
            <a href="/shop" class="btn">Shop Now</a>
          </div>
          <img src="public/assets/img/watchbanner.png" class="home__img" alt="hats" />
        </div>
      </section>

    
<!-- Featured Products Section (copy this into home.ejs) -->
<section class="products container section">
  <h3 class="section__title">Featured Products</h3>
  <div class="products-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    <% if (featuredProducts && featuredProducts.length > 0) { %>
      <% featuredProducts.forEach(product => { %>
        <div class="product-card bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-lg transition-shadow duration-300">
          <a href="/product/<%= product._id %>" class="block">
            <div class="product-image-container relative">
              <img src="<%= product.productImage[0] %>"
                   alt="<%= product.productName %>"
                   class="product-image w-full h-64 object-cover">
              <% if (product.regularPrice > product.salesPrice) { %>
                <div class="discount-badge absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-lg text-sm">
                  <%= Math.round((product.regularPrice - product.salesPrice) / product.regularPrice * 100) %>% OFF
                </div>
              <% } %>
            </div>
            <div class="product-info p-5">
              <div class="mb-3">
                <h3 class="product-title font-bold text-lg text-gray-800 mb-1 line-clamp-2">
                  <%= product.productName %>
                </h3>
                <p class="product-category text-sm text-gray-500"><%= product.category && product.category.name ? product.category.name : '' %></p>
              </div>
              <div class="product-footer flex justify-between items-center">
                <div class="price-container">
                  <p class="current-price text-xl font-bold text-gray-800">₹<%= product.salesPrice.toLocaleString() %></p>
                  <% if (product.regularPrice > product.salesPrice) { %>
                    <p class="original-price text-sm text-gray-500 line-through">
                      ₹<%= product.regularPrice.toLocaleString() %>
                    </p>
                  <% } %>
                </div>
              </div>
            </div>
          </a>
          <div class="px-5 pb-5">
            <button onclick="addToCart('<%= product._id %>', event)" 
        class="w-full add-to-cart-btn px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
    <i class="fas fa-cart-plus"></i> Add to Cart
</button>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <div class="empty-state text-center py-12">
        <svg class="empty-state-icon mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="empty-state-title mt-2 text-sm font-medium text-gray-900">No products found</h3>
        <p class="empty-state-description mt-1 text-sm text-gray-500">Try adjusting your search or filter criteria</p>
      </div>
    <% } %>
  </div>
</section>
 

      <!--=============== DEALS ===============-->
      <section class="deals section">
        <div class="deals__container container grid">
          <div class="deals__item">
            <div class="deals__group">
              <h3 class="deals__brand">Deals of the Day</h3>
              <span class="deals__category">Limited quantities</span>
            </div>
            <h4 class="deals__title">Summer Collection New Modern Watches</h4>
            <div class="deals__price flex">
              <span class="new__price">$139.00</span>
              <span class="old__price">$160.99</span>
            </div>
            <div class="deals__group">
              <p class="deals__countdown-text">Hurry Up! Offer Ends In:</p>
              <div class="countdown">
                <div class="countdown__amount">
                  <p class="countdown__period">02</p>
                  <span class="unit">Days</span>
                </div>
                <div class="countdown__amount">
                  <p class="countdown__period">22</p>
                  <span class="unit">Hours</span>
                </div>
                <div class="countdown__amount">
                  <p class="countdown__period">57</p>
                  <span class="unit">Mins</span>
                </div>
                <div class="countdown__amount">
                  <p class="countdown__period">28</p>
                  <span class="unit">Sec</span>
                </div>
              </div>
            </div>
            <div class="deals__btn">
              <a href="details.html" class="btn btn--md">Shop Now</a>
            </div>
          </div>
          <div class="deals__item">
            <div class="deals__group">
              <h3 class="deals__brand">Women Watches</h3>
              <span class="deals__category">Watches</span>
            </div>
            <h4 class="deals__title">Try Something new on vacation</h4>
            <div class="deals__price flex">
              <span class="new__price">$178.00</span>
              <span class="old__price">$256.99</span>
            </div>
            <div class="deals__group">
              <p class="deals__countdown-text">Hurry Up! Offer Ends In:</p>
              <div class="countdown">
                <div class="countdown__amount">
                  <p class="countdown__period">02</p>
                  <span class="unit">Days</span>
                </div>
                <div class="countdown__amount">
                  <p class="countdown__period">22</p>
                  <span class="unit">Hours</span>
                </div>
                <div class="countdown__amount">
                  <p class="countdown__period">57</p>
                  <span class="unit">Mins</span>
                </div>
                <div class="countdown__amount">
                  <p class="countdown__period">28</p>
                  <span class="unit">Sec</span>
                </div>
              </div>
            </div>
            <div class="deals__btn">
              <a href="details.html" class="btn btn--md">Shop Now</a>
            </div>
          </div>
        </div>
      </section>

      

      

      <!--=============== NEWSLETTER ===============-->
      <section class="newsletter section home__newsletter">
        <div class="newsletter__container container grid">
          <h3 class="newsletter__title flex">
            <img
              src="./assets/img/icon-email.svg"
              alt=""
              class="newsletter__icon"
            />
            Sign in to Newsletter
          </h3>
          <p class="newsletter__description">
            ...and receive $25 coupon for first shopping.
          </p>
          <form action="" class="newsletter__form">
            <input
              type="text"
              placeholder="Enter Your Email"
              class="newsletter__input"
            />
            <button type="submit" class="newsletter__btn">Subscribe</button>
          </form>
        </div>
      </section>
    </main>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
async function addToCart(productId, event) {
    const button = event.target;
    if (button.disabled) return;

    // Save original button content
    const originalHTML = button.innerHTML;
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
    button.style.opacity = '0.7';

    try {
        const response = await fetch('/cart/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId, quantity: 1 })
        });

        const data = await response.json();

        if (data.success) {
            // Success: Green checkmark + exact toast like your photo
            button.innerHTML = '<i class="fas fa-check"></i> Added!';
            button.style.backgroundColor = '#10b981';

            // EXACT SAME TOAST AS YOUR PHOTO
            Swal.fire({
                icon: 'success',
                title: 'Added to Cart!',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                background: '#ffffff',
                padding: '1rem 1.5rem',
                customClass: {
                    popup: 'border border-gray-200 shadow-lg',
                    title: 'text-gray-800 font-semibold text-lg',
                    icon: 'text-green-500'
                },
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer);
                    toast.addEventListener('mouseleave', Swal.resumeTimer);
                }
            });

            // Update cart count
            const cartCount = document.querySelector('.cart-count');
            if (cartCount && data.cartCount !== undefined) {
                cartCount.textContent = data.cartCount;
                cartCount.style.display = 'flex';
            }

            // Reset button after 1.5s
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.disabled = false;
                button.style.backgroundColor = '';
                button.style.opacity = '1';
            }, 1500);

        } else {
            throw new Error(data.message || 'Failed to add item');
        }
    } catch (error) {
        button.innerHTML = originalHTML;
        button.disabled = false;
        button.style.opacity = '1';

        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: error.message || 'Something went wrong',
            toast: true,
            position: 'top-end',
            timer: 3000,
            timerProgressBar: true
        });
    }
}
</script>
 <%-include("../../views/partials/user/footer")%>
