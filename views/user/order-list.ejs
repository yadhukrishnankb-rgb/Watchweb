<%- include('../partials/user/header') %>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --green:      #4a5e4a;
  --green-dk:   #3a4a3a;
  --green-lt:   #5a7a5a;
  --bg:         #f0f4f0;
  --text:       #2a3a2a;
  --muted:      #7a9080;
  --line:       rgba(74,94,74,.12);
  --red:        #e8435a;
  --success:    #2ecc71;
  --blue:       #3b82f6;
}

body {
  font-family: 'Nunito', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* â”€â”€â”€ TOP BANNER â”€â”€â”€ */
.profile-banner {
  background: linear-gradient(135deg, #3a4a3a 0%, #4a5e4a 60%, #5a7060 100%);
  padding: 56px 0 0;
  position: relative;
  overflow: hidden;
}
.profile-banner::before {
  content: '';
  position: absolute;
  width: 500px; height: 500px;
  border-radius: 50%;
  background: rgba(255,255,255,.04);
  top: -200px; right: -100px;
  pointer-events: none;
}
.profile-banner::after {
  content: '';
  position: absolute;
  width: 250px; height: 250px;
  border-radius: 50%;
  background: rgba(255,255,255,.03);
  bottom: 30px; left: -80px;
  pointer-events: none;
}

.banner-inner {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 40px;
  position: relative;
  z-index: 1;
}

.banner-title {
  padding: 32px 0;
}
.banner-title h1 {
  font-size: 32px;
  font-weight: 800;
  color: #fff;
  line-height: 1.1;
}

/* â”€â”€â”€ TAB NAV â”€â”€â”€ */
.tab-nav {
  background: rgba(0,0,0,.15);
  border-top: 1px solid rgba(255,255,255,.08);
}
.tab-nav-inner {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 40px;
  display: flex;
  overflow-x: auto;
  scrollbar-width: none;
}
.tab-nav-inner::-webkit-scrollbar { display: none; }

.tnav-btn {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 16px 22px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: rgba(255,255,255,.55);
  background: none;
  border: none;
  cursor: pointer;
  text-decoration: none;
  border-bottom: 3px solid transparent;
  white-space: nowrap;
  transition: color .2s, border-color .2s;
}
.tnav-btn svg { width: 16px; height: 16px; }
.tnav-btn:hover { color: rgba(255,255,255,.9); }
.tnav-btn.active { color: #fff; border-bottom-color: #fff; }
.tnav-btn.logout-btn { color: rgba(255,160,160,.8); margin-left: auto; }
.tnav-btn.logout-btn:hover { color: #ff9090; }

/* â”€â”€â”€ PAGE BODY â”€â”€â”€ */
.page-body {
  max-width: 1100px;
  margin: 0 auto;
  padding: 40px 40px 80px;
}

/* Search Section */
.search-section {
  background: #fff;
  padding: 20px 24px;
  border-radius: 16px;
  margin-bottom: 28px;
  border: 1px solid var(--line);
}
.search-form {
  display: flex;
  gap: 12px;
  align-items: center;
}
.search-input {
  flex: 1;
  max-width: 400px;
  padding: 12px 16px;
  border: 2px solid #c8d8c8;
  border-radius: 10px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  transition: border-color .2s, box-shadow .2s;
}
.search-input:focus {
  outline: none;
  border-color: var(--green);
  box-shadow: 0 0 0 3px rgba(74,94,74,.1);
}
.btn-search {
  padding: 12px 28px;
  background: var(--green);
  color: #fff;
  border: none;
  border-radius: 40px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: background .2s, transform .2s;
}
.btn-search:hover {
  background: var(--green-dk);
  transform: translateY(-1px);
}

/* Order Cards */
.orders-grid {
  display: grid;
  gap: 20px;
}

.order-card {
  background: #fff;
  border-radius: 16px;
  border: 1px solid var(--line);
  overflow: hidden;
  transition: box-shadow .2s, transform .2s;
}
.order-card:hover {
  box-shadow: 0 6px 20px rgba(74,94,74,.12);
  transform: translateY(-2px);
}

.order-header {
  background: linear-gradient(135deg, #dde8dd, #e8f0e8);
  padding: 20px 24px;
  border-bottom: 1px solid var(--line);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 16px;
}

.order-id {
  font-weight: 800;
  font-size: 16px;
  color: var(--green);
}

.order-date {
  color: var(--muted);
  font-size: 13px;
  font-weight: 600;
  margin-top: 4px;
}

.status-badge {
  padding: 6px 16px;
  border-radius: 40px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .4px;
  display: inline-block;
}

.status-pending { background: #fff8e0; color: #b88c00; }
.status-processing { background: #dbeafe; color: #1e40af; }
.status-shipped { background: #dde8dd; color: var(--green); }
.status-delivered { background: #d5f5e3; color: #1a7a45; }
.status-cancelled { background: #fde8ec; color: #991b1b; }
.status-returned { background: #fef3c7; color: #92400e; }
.status-return-request { background: #fde8ec; color: #c62828; }

.order-body {
  padding: 24px;
}

/* Product Images */
.order-items-images {
  display: flex;
  gap: 16px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

.order-items-images > div {
  text-align: center;
}

.order-items-images img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 12px;
  border: 2px solid var(--line);
  transition: transform .2s;
}

.order-items-images img:hover {
  transform: scale(1.05);
}

.order-items-images small {
  display: block;
  margin-top: 6px;
  color: var(--muted);
  font-size: 12px;
  font-weight: 600;
  word-break: break-word;
  max-width: 100px;
}

/* Order Info */
.order-info {
  padding: 20px 0;
  border-top: 1px solid var(--line);
  border-bottom: 1px solid var(--line);
  margin-bottom: 20px;
}

.info-item {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.info-label {
  font-size: 12px;
  font-weight: 700;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: .7px;
}

.info-value {
  font-size: 20px;
  font-weight: 800;
  color: var(--green);
}

/* Order Actions */
.order-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.action-btn {
  padding: 9px 20px;
  border-radius: 40px;
  font-family: 'Nunito', sans-serif;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  text-decoration: none;
  border: none;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: background .2s, transform .2s;
}

.btn-view {
  background: var(--green);
  color: #fff;
}
.btn-view:hover {
  background: var(--green-dk);
  transform: translateY(-1px);
}

.btn-cancel {
  background: #fde8ec;
  color: var(--red);
}
.btn-cancel:hover {
  background: #fbd0d8;
  transform: translateY(-1px);
}

.btn-return {
  background: #fff8e0;
  color: #b88c00;
}
.btn-return:hover {
  background: #fde68a;
  transform: translateY(-1px);
}

.btn-invoice {
  background: #d5f5e3;
  color: #1a7a45;
}
.btn-invoice:hover {
  background: #a7f3d0;
  transform: translateY(-1px);
}

/* Pagination */
.pagination {
  margin-top: 32px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.pagination a {
  padding: 10px 18px;
  border-radius: 10px;
  text-decoration: none;
  font-weight: 700;
  font-size: 14px;
  transition: all .2s;
  min-width: 44px;
  text-align: center;
  font-family: 'Nunito', sans-serif;
}

.pagination a:not(.active) {
  background: #fff;
  color: var(--text);
  border: 1px solid var(--line);
}

.pagination a:not(.active):hover {
  background: #dde8dd;
  border-color: var(--green);
  color: var(--green);
}

.pagination a.active {
  background: var(--green);
  color: #fff;
  border: 1px solid var(--green);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 40px;
  background: #fff;
  border-radius: 16px;
  border: 1px dashed var(--line);
}

.empty-icon {
  font-size: 48px;
  color: #aac0aa;
  margin-bottom: 16px;
}

.empty-title {
  font-size: 24px;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 8px;
}

.empty-text {
  color: var(--muted);
  font-size: 14px;
  margin-bottom: 24px;
}

.btn-shop {
  display: inline-block;
  padding: 12px 32px;
  background: var(--green);
  color: #fff;
  text-decoration: none;
  border-radius: 40px;
  font-weight: 700;
  font-size: 14px;
  transition: all .2s;
}

.btn-shop:hover {
  background: var(--green-dk);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(74,94,74,.2);
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  backdrop-filter: blur(6px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: #fff;
  padding: 32px;
  border-radius: 20px;
  max-width: 500px;
  width: 100%;
  box-shadow: 0 20px 60px rgba(0,0,0,.3);
  animation: modalSlideIn .3s ease-out;
}

@keyframes modalSlideIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-title {
  font-size: 24px;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 12px;
}

.modal-text {
  color: var(--muted);
  font-size: 14px;
  margin-bottom: 20px;
}

.modal-textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #c8d8c8;
  border-radius: 12px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  resize: vertical;
  min-height: 100px;
  margin-bottom: 20px;
  transition: border-color .2s, box-shadow .2s;
}

.modal-textarea:focus {
  outline: none;
  border-color: var(--green);
  box-shadow: 0 0 0 3px rgba(74,94,74,.1);
}

.modal-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.modal-btn {
  padding: 12px 28px;
  border-radius: 40px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  transition: all .2s;
}

.modal-btn-primary {
  background: var(--red);
  color: #fff;
}

.modal-btn-primary:hover {
  background: #c62828;
  transform: translateY(-1px);
}

.modal-btn-secondary {
  background: #e8e8e8;
  color: #555;
}

.modal-btn-secondary:hover {
  background: #d0d0d0;
}

/* Responsive */
@media(max-width: 700px) {
  .banner-inner, .tab-nav-inner { padding: 0 20px; }
  .page-body { padding: 28px 20px 60px; }
  .banner-title h1 { font-size: 24px; }
  .search-form { flex-direction: column; }
  .search-input { max-width: 100%; }
  .btn-search { width: 100%; }
  .order-header { flex-direction: column; align-items: flex-start; }
  .order-actions { flex-direction: column; width: 100%; }
  .action-btn { width: 100%; justify-content: center; }
}
</style>

<!-- â•â•â• PROFILE BANNER â•â•â• -->
<div class="profile-banner">
  <div class="banner-inner">
    <div class="banner-title">
      <h1>Your Orders</h1>
    </div>
  </div>

  <!-- TAB NAV -->
  <div class="tab-nav">
    <div class="tab-nav-inner">
      <a href="/profile" class="tnav-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        My Info
      </a>
      <a href="/profile/address" class="tnav-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        Address
      </a>
      <a href="/orders" class="tnav-btn active">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
        Orders
      </a>
      <a href="/profile#wallet" class="tnav-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
        My Wallet
      </a>
      <a href="/logout" class="tnav-btn logout-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
        Logout
      </a>
    </div>
  </div>
</div>

<!-- â•â•â• PAGE BODY â•â•â• -->
<div class="page-body">

  <!-- Search -->
  <div class="search-section">
    <form class="search-form" method="GET">
      <input type="text" name="search" value="<%= search %>" placeholder="Search by Order ID..." class="search-input" />
      <button type="submit" class="btn-search">Search</button>
    </form>
  </div>

  <% if (orders.length > 0) { %>
    <div class="orders-grid">
      <% orders.forEach(order => { %>
        <div class="order-card">
          <div class="order-header">
            <div>
              <div class="order-id">#<%= order.orderId %></div>
              <div class="order-date">
                <%= new Date(order.createdOn).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
              </div>
            </div>
            <% 
              const rawStatus = (order.status || order.orderStatus || order.currentStatus || order.state || '').toString().trim().toLowerCase();
              const itemStatuses = (order.orderedItems || []).map(i => ((i.status||'').toString().trim().toLowerCase())).filter(Boolean);

              let derivedStatus = rawStatus || '';
              if (itemStatuses.length > 0) {
                if (itemStatuses.every(s => s === 'returned')) derivedStatus = 'returned';
                else if (itemStatuses.every(s => s === 'cancelled')) derivedStatus = 'cancelled';
                else if (itemStatuses.every(s => s === 'return request' || s === 'returned')) derivedStatus = derivedStatus || 'return request';
                else if (!derivedStatus) derivedStatus = itemStatuses.find(Boolean) || 'pending';
              }

              const statusClass = (derivedStatus || 'pending').replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');
              const statusDisplay = (derivedStatus || 'pending').split(/\s+/).map(s => s ? (s.charAt(0).toUpperCase() + s.slice(1).toLowerCase()) : '').filter(Boolean).join(' ');
            %>
            <span class="status-badge status-<%= statusClass %>"><%= statusDisplay %></span>
          </div>
          
          <div class="order-body">
            <!-- Product Images -->
            <div class="order-items-images">
              <% order.orderedItems.forEach(item => { %>
                <div>
                  <img 
                    src="<%= item.productSnapshot?.image || '/assets/img/placeholder.png' %>" 
                    alt="<%= item.name %>"
                  />
                  <small><%= item.name.substring(0, 20) %>...</small>
                  <small style="color: var(--green); font-weight: 700;">Qty: <%= item.quantity %></small>
                </div>
              <% }) %>
            </div>

            <div class="order-info">
              <% 
                const orderStatusLC = ((order.status||'').toString().trim().toLowerCase());
                const subtotal = Number(order.subtotal || 0);
                const totalTax = Number(order.tax || 0);
                const totalDiscount = Number(order.discount || 0);

                const refundedVal = (() => {
                  if (order.refunded != null && !isNaN(Number(order.refunded)) && Number(order.refunded) > 0) return Number(order.refunded);
                  return (order.orderedItems || []).reduce((a, it) => {
                    const st = ((it.status||'').toString().toLowerCase());
                    if (['cancelled','returned'].includes(st)) {
                      if (it.refundAmount != null && !isNaN(Number(it.refundAmount))) return a + Number(it.refundAmount);
                      const itemSubtotal = Number(it.totalPrice ?? (it.price * it.quantity) ?? 0);
                      const taxShare = subtotal > 0 ? (itemSubtotal / subtotal) * totalTax : 0;
                      const discountShare = subtotal > 0 ? (itemSubtotal / subtotal) * totalDiscount : 0;
                      return a + (itemSubtotal + taxShare - discountShare);
                    }
                    return a;
                  }, 0);
                })();

                const roundedRefunded = Math.round((refundedVal + Number.EPSILON) * 100) / 100;
                const cappedRefunded = Math.min(roundedRefunded, Number(order.finalAmount || 0));
                const finalPaid = Math.max(0, Math.round(((order.finalAmount || 0) - cappedRefunded + Number.EPSILON) * 100) / 100);
                const hasItemRefund = cappedRefunded > 0;
              %>

              <div class="info-item">
                <span class="info-label">Total Amount</span>
                <span class="info-value">â‚¹<%= order.finalAmount.toLocaleString() %></span>

                <% if (orderStatusLC === 'cancelled' || orderStatusLC === 'returned') { %>
                  <small style="color: var(--success); font-weight: 700; margin-top: 6px;">Full Refund Processed</small>
                <% } else if (hasItemRefund) { %>
                  <small style="color: var(--success); font-weight: 700; margin-top: 6px;">Partial Refund Processed</small>
                <% } %>

                <% if (hasItemRefund) { %>
                  <div style="margin-top:8px; color: var(--success); font-weight:700; font-size: 13px;">
                    Refunded: â‚¹<%= cappedRefunded.toLocaleString() %>
                    &nbsp;&middot;&nbsp; Paid: â‚¹<%= finalPaid.toLocaleString() %>
                  </div>
                <% } %>
              </div>
            </div>
            
            <div class="order-actions">
              <a href="/orders/<%= order._id %>" class="action-btn btn-view">
                View Details
              </a>
              <% if (orderStatusLC === 'pending') { %>
                <button onclick="cancelOrder('<%= order._id %>')" class="action-btn btn-cancel">
                  Cancel Order
                </button>
              <% } %>
              <% 
                const allReturnedOrCancelled = order.orderedItems && order.orderedItems.every(item => ['returned','cancelled'].includes(((item.status||'').toString().toLowerCase())));
              %>
              <% if (orderStatusLC === 'delivered' && !allReturnedOrCancelled) { %>
                <button onclick="returnOrder('<%= order._id %>')" class="action-btn btn-return">
                  Return Order
                </button>
              <% } %>
              <% 
                const orderHasDeliveredItem = order.orderedItems?.some(item => ['delivered','returned'].includes(((item.status||'').toString().toLowerCase())));
                const canShowInvoice = (orderStatusLC === 'delivered') || orderHasDeliveredItem;
              %>
              <% if (canShowInvoice) { %>
                <a href="/orders/<%= order._id %>/invoice" class="action-btn btn-invoice">
                  Download Invoice
                </a>
              <% } %>
            </div>
          </div>
        </div>
      <% }) %>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %>&search=<%= search %>">Previous</a>
      <% } %>
      <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="?page=<%= i %>&search=<%= search %>" class="<%= i === currentPage ? 'active' : '' %>"><%= i %></a>
      <% } %>
      <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %>&search=<%= search %>">Next</a>
      <% } %>
    </div>
  <% } else { %>
    <div class="empty-state">
      <div class="empty-icon">ðŸ“¦</div>
      <h3 class="empty-title">No orders found</h3>
      <p class="empty-text">You haven't placed any orders yet. Start shopping to see your orders here!</p>
      <a href="/shop" class="btn-shop">Start Shopping</a>
    </div>
  <% } %>

</div>

<!-- Cancel Modal -->
<div id="cancelModal" class="modal">
  <div class="modal-content">
    <h3 class="modal-title">Cancel Order</h3>
    <p class="modal-text">Are you sure you want to cancel this order? This action cannot be undone.</p>
    <textarea id="cancelReason" placeholder="Please tell us why you're canceling (optional)" class="modal-textarea"></textarea>
    <div class="modal-actions">
      <button onclick="closeModal('cancelModal')" class="modal-btn modal-btn-secondary">Keep Order</button>
      <button onclick="confirmCancel()" class="modal-btn modal-btn-primary">Yes, Cancel Order</button>
    </div>
  </div>
</div>

<!-- Return Modal -->
<div id="returnModal" class="modal">
  <div class="modal-content">
    <h3 class="modal-title">Request Return</h3>
    <p class="modal-text">Please tell us why you want to return this order. This helps us improve our service.</p>
    <textarea id="returnReason" placeholder="Return reason (required)" class="modal-textarea" required></textarea>
    <div class="modal-actions">
      <button onclick="closeModal('returnModal')" class="modal-btn modal-btn-secondary">Cancel</button>
      <button onclick="confirmReturn()" class="modal-btn modal-btn-primary">Submit Return Request</button>
    </div>
  </div>
</div>

<script>
let currentOrderId = '';

function cancelOrder(id) {
  currentOrderId = id;
  document.getElementById('cancelModal').classList.add('active');
}

function returnOrder(id) {
  currentOrderId = id;
  document.getElementById('returnModal').classList.add('active');
}

function confirmCancel() {
  const reason = document.getElementById('cancelReason').value;
  fetch(`/orders/${currentOrderId}/cancel`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ reason, isFullOrder: true })
  }).then(res => res.json()).then(async data => {
    if (data.success) return location.reload();
    await Swal.fire({ icon: 'error', title: data.message || 'Unable to cancel order' });
  }).catch(async err => {
    console.error(err);
    await Swal.fire({ icon: 'error', title: 'Error cancelling order' });
  });
}

function confirmReturn() {
  const reason = document.getElementById('returnReason').value;
  if (!reason) return Swal.fire({ icon: 'warning', title: 'Reason required' });
  fetch(`/orders/${currentOrderId}/return`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ reason })
  }).then(res => res.json()).then(async data => {
    if (data.success) return location.reload();
    await Swal.fire({ icon: 'error', title: data.message || 'Unable to submit return' });
  }).catch(async err => {
    console.error(err);
    await Swal.fire({ icon: 'error', title: 'Error submitting return' });
  });
}

function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}

// Close modal when clicking outside
document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', e => {
    if (e.target === modal) closeModal(modal.id);
  });
});
</script>

<%- include('../partials/user/footer') %>