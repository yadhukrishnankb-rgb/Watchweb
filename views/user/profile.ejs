<%- include('../partials/user/header') %>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --green:      #4a5e4a;
  --green-dk:   #3a4a3a;
  --green-lt:   #5a7a5a;
  --bg:         #f0f4f0;
  --text:       #2a3a2a;
  --muted:      #7a9080;
  --line:       rgba(74,94,74,.12);
  --red:        #e8435a;
  --success:    #2ecc71;
}

body {
  font-family: 'Nunito', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* ─── TOP BANNER ─── */
.profile-banner {
  background: linear-gradient(135deg, #3a4a3a 0%, #4a5e4a 60%, #5a7060 100%);
  padding: 56px 0 0;
  position: relative;
  overflow: hidden;
}
.profile-banner::before {
  content: '';
  position: absolute;
  width: 500px; height: 500px;
  border-radius: 50%;
  background: rgba(255,255,255,.04);
  top: -200px; right: -100px;
  pointer-events: none;
}
.profile-banner::after {
  content: '';
  position: absolute;
  width: 250px; height: 250px;
  border-radius: 50%;
  background: rgba(255,255,255,.03);
  bottom: 30px; left: -80px;
  pointer-events: none;
}

.banner-inner {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 40px;
  position: relative;
  z-index: 1;
}

.banner-top {
  display: flex;
  align-items: center;
  gap: 28px;
  margin-bottom: 32px;
}
.banner-avatar {
  width: 100px; height: 100px;
  border-radius: 50%;
  border: 3px solid rgba(255,255,255,.35);
  object-fit: cover;
  flex-shrink: 0;
}
.banner-name h1 {
  font-size: 28px;
  font-weight: 800;
  color: #fff;
  line-height: 1.1;
  margin-bottom: 5px;
}
.banner-name p {
  color: rgba(255,255,255,.6);
  font-size: 14px;
}

.banner-pills {
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
  margin-bottom: 28px;
}
.pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(255,255,255,.13);
  border: 1px solid rgba(255,255,255,.2);
  color: #fff;
  border-radius: 40px;
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 600;
}
.pill svg { width: 15px; height: 15px; opacity: .8; }

.banner-actions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 36px;
}
.ba-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 11px 26px;
  border-radius: 40px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  text-decoration: none;
  transition: transform .2s, opacity .2s;
}
.ba-btn:hover { transform: translateY(-2px); opacity: .9; }
.ba-btn.white { background: #fff; color: var(--green); }
.ba-btn.ghost { background: rgba(255,255,255,.14); color: #fff; border: 1px solid rgba(255,255,255,.28); }

/* ─── TAB NAV ─── */
.tab-nav {
  background: rgba(0,0,0,.15);
  border-top: 1px solid rgba(255,255,255,.08);
}
.tab-nav-inner {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 40px;
  display: flex;
  overflow-x: auto;
  scrollbar-width: none;
}
.tab-nav-inner::-webkit-scrollbar { display: none; }

.tnav-btn {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 16px 22px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: rgba(255,255,255,.55);
  background: none;
  border: none;
  cursor: pointer;
  text-decoration: none;
  border-bottom: 3px solid transparent;
  white-space: nowrap;
  transition: color .2s, border-color .2s;
}
.tnav-btn svg { width: 16px; height: 16px; }
.tnav-btn:hover { color: rgba(255,255,255,.9); }
.tnav-btn.active { color: #fff; border-bottom-color: #fff; }
.tnav-btn.logout-btn { color: rgba(255,160,160,.8); margin-left: auto; }
.tnav-btn.logout-btn:hover { color: #ff9090; }

/* ─── PAGE BODY ─── */
.page-body {
  max-width: 1100px;
  margin: 0 auto;
  padding: 40px 40px 80px;
}

/* flash */
.flash {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 14px 20px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 28px;
}
.flash.ok  { background: #d5f5e3; color: #1a7a45; border-left: 4px solid var(--success); }
.flash.err { background: #fde8ec; color: #9a1928; border-left: 4px solid var(--red); }
.flash svg { width: 18px; height: 18px; flex-shrink: 0; }

/* tab panels */
.tab-panel { display: none; animation: fadeUp .3s ease both; }
.tab-panel.active { display: block; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ─── SECTION HEADING ─── */
.sec-heading {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--line);
  margin-bottom: 28px;
}
.sec-heading h2 {
  font-size: 20px;
  font-weight: 800;
  color: var(--green);
}
.sec-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 9px 22px;
  background: var(--green);
  color: #fff;
  border: none;
  border-radius: 40px;
  font-family: 'Nunito', sans-serif;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  text-decoration: none;
  transition: background .2s, transform .2s;
}
.sec-btn:hover { background: var(--green-dk); transform: translateY(-1px); }

/* ─── MY INFO — flat rows ─── */
.info-rows { display: flex; flex-direction: column; }
.info-row {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 20px 0;
  border-bottom: 1px solid var(--line);
}
.info-row:last-child { border-bottom: none; }
.ir-icon {
  width: 44px; height: 44px;
  background: linear-gradient(135deg, #dde8dd, #ccdacc);
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.ir-icon svg { width: 20px; height: 20px; color: var(--green); }
.ir-label { font-size: 12px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .7px; margin-bottom: 4px; }
.ir-value { font-size: 16px; font-weight: 600; color: var(--text); }

/* ─── ADDRESS FORM ─── */
.addr-form {
  display: none;
  padding: 28px 0;
  border-bottom: 2px dashed var(--line);
  margin-bottom: 8px;
  animation: fadeUp .3s ease both;
}
.addr-form.active { display: block; }

.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
@media(max-width:600px){ .form-grid { grid-template-columns: 1fr; } }

.fg { display: flex; flex-direction: column; gap: 7px; }
.fg label { font-size: 12px; font-weight: 700; color: var(--green-dk); text-transform: uppercase; letter-spacing: .5px; }
.fg input {
  padding: 12px 16px;
  border: 2px solid #c8d8c8;
  border-radius: 10px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  background: #fff;
  transition: border-color .2s, box-shadow .2s;
}
.fg input:focus { outline: none; border-color: var(--green); box-shadow: 0 0 0 3px rgba(74,94,74,.1); }

.form-actions { display: flex; gap: 12px; margin-top: 20px; }
.fa-save {
  padding: 12px 32px;
  background: var(--green); color: #fff;
  border: none; border-radius: 40px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px; font-weight: 700;
  cursor: pointer; transition: background .2s;
}
.fa-save:hover { background: var(--green-dk); }
.fa-cancel {
  padding: 12px 32px;
  background: #e8e8e8; color: #555;
  border: none; border-radius: 40px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px; font-weight: 700;
  cursor: pointer; transition: background .2s;
}
.fa-cancel:hover { background: #ddd; }

/* ─── ADDRESS ROWS ─── */
.addr-list { display: flex; flex-direction: column; }
.addr-row {
  display: flex;
  align-items: flex-start;
  gap: 18px;
  padding: 20px 0;
  border-bottom: 1px solid var(--line);
}
.addr-row:last-child { border-bottom: none; }
.addr-icon {
  width: 40px; height: 40px;
  background: linear-gradient(135deg, #dde8dd, #ccdacc);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; margin-top: 2px;
}
.addr-icon svg { width: 18px; height: 18px; color: var(--green); }
.addr-text { flex: 1; font-size: 15px; line-height: 1.7; color: var(--text); font-weight: 500; }
.addr-btns { display: flex; gap: 10px; flex-shrink: 0; flex-wrap: wrap; align-items: center; }
.ab-edit {
  padding: 7px 18px; background: #dde8dd; color: var(--green);
  border: none; border-radius: 40px; font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 700; cursor: pointer; text-decoration: none;
  transition: background .2s;
}
.ab-edit:hover { background: #ccdacc; }
.ab-del {
  padding: 7px 18px; background: #fde8ec; color: var(--red);
  border: none; border-radius: 40px; font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 700; cursor: pointer; text-decoration: none;
  transition: background .2s;
}
.ab-del:hover { background: #fbd0d8; }

/* ─── ORDER ROWS ─── */
.order-list { display: flex; flex-direction: column; }
.order-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
  padding: 22px 0;
  border-bottom: 1px solid var(--line);
  flex-wrap: wrap;
}
.order-row:last-child { border-bottom: none; }
.or-left { display: flex; flex-direction: column; gap: 6px; }
.or-id { font-size: 15px; font-weight: 800; color: var(--green); }
.or-meta { font-size: 13px; color: var(--muted); font-weight: 600; display: flex; gap: 12px; flex-wrap: wrap; }
.or-right { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }

.badge {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 5px 14px; border-radius: 40px;
  font-size: 12px; font-weight: 700;
  text-transform: uppercase; letter-spacing: .4px;
}
.badge.placed    { background: #fff8e0; color: #b88c00; }
.badge.shipped   { background: #dde8dd; color: var(--green); }
.badge.delivered { background: #d5f5e3; color: #1a7a45; }

.ob-view {
  padding: 9px 20px; background: var(--green); color: #fff;
  border: none; border-radius: 40px; font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 700; cursor: pointer; text-decoration: none;
  transition: background .2s;
}
.ob-view:hover { background: var(--green-dk); }
.ob-cancel {
  padding: 9px 20px; background: #fde8ec; color: var(--red);
  border: none; border-radius: 40px; font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 700; cursor: pointer; text-decoration: none;
  transition: background .2s;
}
.ob-cancel:hover { background: #fbd0d8; }

/* ─── WALLET ─── */
.wallet-top {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  padding: 32px 0 28px;
  border-bottom: 2px solid var(--line);
  margin-bottom: 28px;
  flex-wrap: wrap;
  gap: 16px;
}
.wt-label { font-size: 12px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .7px; margin-bottom: 10px; }
.wt-amount { font-size: 56px; font-weight: 800; color: var(--green); line-height: 1; }
.wt-sub { font-size: 13px; color: var(--muted); margin-top: 8px; font-weight: 600; }

.txn-heading { font-size: 14px; font-weight: 800; color: var(--muted); text-transform: uppercase; letter-spacing: .7px; margin-bottom: 4px; }
.txn-list { display: flex; flex-direction: column; }
.txn-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 18px 0; border-bottom: 1px solid var(--line); gap: 16px;
}
.txn-row:last-child { border-bottom: none; }
.txn-dot-wrap { display: flex; align-items: center; gap: 14px; flex: 1; }
.txn-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
.txn-dot.cr { background: var(--success); }
.txn-dot.db { background: var(--red); }
.txn-desc { font-size: 14px; font-weight: 700; color: var(--text); }
.txn-date { font-size: 12px; color: var(--muted); font-weight: 600; margin-top: 2px; }
.txn-amt { font-size: 16px; font-weight: 800; }
.txn-amt.cr { color: var(--success); }
.txn-amt.db { color: var(--red); }

/* empty states */
.empty-msg {
  padding: 40px 0; text-align: center;
  color: var(--muted); font-size: 14px; font-weight: 600;
}
.empty-msg svg { width: 38px; height: 38px; color: #aac0aa; margin: 0 auto 12px; display: block; }

/* ─── RESPONSIVE ─── */
@media(max-width: 700px) {
  .banner-inner, .tab-nav-inner { padding: 0 20px; }
  .page-body { padding: 28px 20px 60px; }
  .banner-name h1 { font-size: 22px; }
  .wt-amount { font-size: 42px; }
  .order-row { flex-direction: column; align-items: flex-start; }
  .or-right { width: 100%; }
  .addr-row { flex-wrap: wrap; }
  .addr-btns { width: 100%; }
}
</style>

<!-- ═══ PROFILE BANNER ═══ -->
<div class="profile-banner">
  <div class="banner-inner">
    <div class="banner-top">
      <img src="<%= user.profileImage || 'https://via.placeholder.com/120' %>" class="banner-avatar" alt="Profile">
      <div class="banner-name">
        <h1><%= user.name %></h1>
        <p>Member Account</p>
      </div>
    </div>

    <div class="banner-pills">
      <span class="pill">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
        <%= user.email %>
      </span>
      <span class="pill">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
        <%= user.phone %>
      </span>
    </div>

    <div class="banner-actions">
      <a href="/profile/edit" class="ba-btn white">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
        Edit Profile
      </a>
      <a href="/profile/change-password" class="ba-btn ghost">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
        Change Password
      </a>
    </div>
  </div>

  <!-- TAB NAV -->
  <div class="tab-nav">
    <div class="tab-nav-inner">
      <a href="#myinfo" class="tnav-btn active" data-tab="myinfo">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        My Info
      </a>
      <a href="/profile/address" class="tnav-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        Address
      </a>
      <a href="/orders" class="tnav-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
        Orders
      </a>
      <a href="/wallet" class="tnav-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
        My Wallet
      </a>
      <a href="/logout" class="tnav-btn logout-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
        Logout
      </a>
    </div>
  </div>
</div>

<!-- ═══ PAGE BODY ═══ -->
<div class="page-body">

  <% if (success) { %>
    <div class="flash ok">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      <%= success %>
    </div>
  <% } %>
  <% if (error) { %>
    <div class="flash err">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      <%= error %>
    </div>
  <% } %>

  <!-- MY INFO -->
  <div id="myinfo" class="tab-panel active">
    <div class="sec-heading"><h2>My Information</h2></div>
    <div class="info-rows">
      <div class="info-row">
        <div class="ir-icon"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg></div>
        <div><div class="ir-label">Full Name</div><div class="ir-value"><%= user.name %></div></div>
      </div>
      <div class="info-row">
        <div class="ir-icon"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg></div>
        <div><div class="ir-label">Email Address</div><div class="ir-value"><%= user.email %></div></div>
      </div>
      <div class="info-row">
        <div class="ir-icon"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg></div>
        <div><div class="ir-label">Phone Number</div><div class="ir-value"><%= user.phone %></div></div>
      </div>
    </div>
  </div>

  <!-- WALLET -->
 

</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
<% if (success) { %>
  Swal.fire({ icon:'success', title:'Success!', text:'<%= success %>', timer:3000, showConfirmButton:false });
<% } %>
<% if (error) { %>
  Swal.fire({ icon:'error', title:'Oops!', text:'<%= error %>' });
<% } %>

document.querySelectorAll('.tnav-btn[data-tab]').forEach(btn => {
  btn.addEventListener('click', e => {
    e.preventDefault();
    const target = btn.getAttribute('data-tab');
    document.querySelectorAll('.tnav-btn[data-tab]').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(target).classList.add('active');
  });
});

if (window.location.pathname === '/profile/address') {
  document.querySelectorAll('.tnav-btn[data-tab]').forEach(b => b.classList.remove('active'));
  const at = document.querySelector('.tnav-btn[href="/profile/address"]');
  if (at) at.classList.add('active');
}
</script>

<%- include('../partials/user/footer') %>